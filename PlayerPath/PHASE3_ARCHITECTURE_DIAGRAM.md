# Video Upload & Storage - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PHASE 3: VIDEO UPLOAD FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Coach Selects   â”‚
â”‚   Video to Upload â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STEP 1: THUMBNAIL GENERATION                          â”‚
â”‚                         (Progress: 0% â†’ 10%)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  [VideoFileManager.generateThumbnail()]                                   â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â”œâ”€â†’ Use AVAssetImageGenerator                                        â”‚
â”‚     â”œâ”€â†’ Extract frame at 1 second                                        â”‚
â”‚     â”œâ”€â†’ Resize to 160x120 (preserve aspect)                              â”‚
â”‚     â”œâ”€â†’ Compress to JPEG (0.8 quality)                                   â”‚
â”‚     â””â”€â†’ Save to local documents directory                                â”‚
â”‚                                                                           â”‚
â”‚  Output: /Documents/thumb_UUID.jpg (~10-20KB)                            â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STEP 2: THUMBNAIL UPLOAD                             â”‚
â”‚                        (Progress: 10% â†’ 20%)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  [VideoCloudManager.uploadThumbnail()]                                    â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â”œâ”€â†’ Read thumbnail data from local file                              â”‚
â”‚     â”œâ”€â†’ Create Firebase Storage reference                                â”‚
â”‚     â”‚   Path: shared_folders/{folderID}/thumbnails/{name}_thumbnail.jpg  â”‚
â”‚     â”œâ”€â†’ Set metadata:                                                    â”‚
â”‚     â”‚   â€¢ contentType: "image/jpeg"                                      â”‚
â”‚     â”‚   â€¢ cacheControl: "public, max-age=31536000" (1 year)             â”‚
â”‚     â”œâ”€â†’ Upload to Firebase Storage                                       â”‚
â”‚     â”œâ”€â†’ Get download URL with security token                             â”‚
â”‚     â””â”€â†’ Clean up local thumbnail file                                    â”‚
â”‚                                                                           â”‚
â”‚  Output: https://firebasestorage.../thumbnails/video_thumbnail.jpg       â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 3: VIDEO UPLOAD                               â”‚
â”‚                       (Progress: 20% â†’ 100%)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  [VideoCloudManager.uploadVideo()]                                        â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â”œâ”€â†’ Read video data from URL                                         â”‚
â”‚     â”œâ”€â†’ Create Firebase Storage reference                                â”‚
â”‚     â”‚   Path: shared_folders/{folderID}/game_opponent_2025-11-22.mov    â”‚
â”‚     â”œâ”€â†’ Set metadata:                                                    â”‚
â”‚     â”‚   â€¢ contentType: "video/quicktime"                                 â”‚
â”‚     â”œâ”€â†’ Create upload task                                               â”‚
â”‚     â”œâ”€â†’ Observe progress:                                                â”‚
â”‚     â”‚   â€¢ completedUnitCount / totalUnitCount                            â”‚
â”‚     â”‚   â€¢ Update UI in real-time                                         â”‚
â”‚     â”œâ”€â†’ Upload to Firebase Storage                                       â”‚
â”‚     â””â”€â†’ Get download URL with security token                             â”‚
â”‚                                                                           â”‚
â”‚  Output: https://firebasestorage.../shared_folders/.../video.mov         â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 4: SAVE METADATA TO FIRESTORE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  [FirestoreManager.createVideoMetadata()]                                 â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â””â”€â†’ Create document in /videos collection:                           â”‚
â”‚         {                                                                 â”‚
â”‚           id: "video123"                                                  â”‚
â”‚           fileName: "game_opponent_2025-11-22.mov"                       â”‚
â”‚           firebaseStorageURL: "https://...video.mov"                     â”‚
â”‚           thumbnailURL: "https://...thumbnail.jpg"        â† NEW!         â”‚
â”‚           uploadedBy: "coach456"                                          â”‚
â”‚           uploadedByName: "Coach Smith"                                   â”‚
â”‚           sharedFolderID: "folder123"                                     â”‚
â”‚           isHighlight: false                                              â”‚
â”‚           videoType: "game"                                               â”‚
â”‚           gameOpponent: "Tigers"                                          â”‚
â”‚           gameDate: 2025-11-22                                            â”‚
â”‚           createdAt: Date()                                               â”‚
â”‚         }                                                                 â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Upload Complete â”‚
                        â”‚   âœ… Success!    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIDEO PLAYBACK & SECURITY FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Coach Opens     â”‚
â”‚  Video to Watch  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 1: FETCH VIDEO METADATA FROM FIRESTORE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  [FirestoreManager.fetchVideos(forSharedFolder:)]                         â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â””â”€â†’ Query: /videos where sharedFolderID == "folder123"               â”‚
â”‚                                                                           â”‚
â”‚  Returns: Array<FirestoreVideoMetadata>                                  â”‚
â”‚     - fileName                                                            â”‚
â”‚     - firebaseStorageURL                                                  â”‚
â”‚     - thumbnailURL                                                        â”‚
â”‚     - other metadata...                                                   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STEP 2: GET SECURE DOWNLOAD URL                         â”‚
â”‚                       (Optional - URL already in metadata)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  Option A: Use URL from metadata (recommended)                            â”‚
â”‚     â””â”€â†’ firebaseStorageURL already includes security token               â”‚
â”‚                                                                           â”‚
â”‚  Option B: Regenerate URL (if needed)                                    â”‚
â”‚     [VideoCloudManager.getSecureDownloadURL()]                            â”‚
â”‚        â”‚                                                                  â”‚
â”‚        â”œâ”€â†’ Create Storage reference                                      â”‚
â”‚        â”œâ”€â†’ Call .downloadURL()                                           â”‚
â”‚        â””â”€â†’ Returns URL with fresh token                                  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                STEP 3: FIREBASE VALIDATES ACCESS (AUTOMATIC)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  When video URL is accessed, Firebase Storage:                           â”‚
â”‚                                                                           â”‚
â”‚  1. Extracts security token from URL                                     â”‚
â”‚  2. Verifies user is authenticated                                       â”‚
â”‚  3. Checks Storage Rules:                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚ match /shared_folders/{folderID}/{file} {  â”‚                      â”‚
â”‚     â”‚   allow read: if isOwner(folderID) ||      â”‚                      â”‚
â”‚     â”‚                  isSharedCoach(folderID);  â”‚                      â”‚
â”‚     â”‚ }                                           â”‚                      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚  4. Queries Firestore to check folder permissions                        â”‚
â”‚  5. If authorized: âœ… Serve video                                        â”‚
â”‚     If unauthorized: âŒ Return 403 Forbidden                             â”‚
â”‚                                                                           â”‚
â”‚  This happens on EVERY request - instant permission validation!          â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Video Plays in App    â”‚
                    â”‚     (AVPlayer/etc)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STORAGE STRUCTURE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FIREBASE STORAGE (Files)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

firebasestorage.googleapis.com/v0/b/playerpath-app.appspot.com/o/

â”œâ”€â”€ shared_folders/
â”‚   â”‚
â”‚   â”œâ”€â”€ folder_abc123/
â”‚   â”‚   â”œâ”€â”€ game_Tigers_2025-11-22.mov           (Video file)
â”‚   â”‚   â”œâ”€â”€ game_Lions_2025-11-21.mov            (Video file)
â”‚   â”‚   â”œâ”€â”€ practice_2025-11-20.mov              (Video file)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ thumbnails/                           â† NEW FOLDER
â”‚   â”‚       â”œâ”€â”€ game_Tigers_2025-11-22_thumbnail.jpg
â”‚   â”‚       â”œâ”€â”€ game_Lions_2025-11-21_thumbnail.jpg
â”‚   â”‚       â””â”€â”€ practice_2025-11-20_thumbnail.jpg
â”‚   â”‚
â”‚   â””â”€â”€ folder_xyz789/
â”‚       â”œâ”€â”€ game_Eagles_2025-11-22.mov
â”‚       â””â”€â”€ thumbnails/
â”‚           â””â”€â”€ game_Eagles_2025-11-22_thumbnail.jpg
â”‚
â””â”€â”€ videos/                                       (Future: athlete personal)
    â””â”€â”€ athleteID/
        â””â”€â”€ personal_video.mov


FIRESTORE (Metadata)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/users/
â”‚   â””â”€â”€ {userID}
â”‚       - email, role, isPremium, ...

/sharedFolders/
â”‚   â””â”€â”€ {folderID}
â”‚       - name: "Coach Smith Folder"
â”‚       - ownerAthleteID: "athlete123"
â”‚       - sharedWithCoachIDs: ["coach456", "coach789"]
â”‚       - permissions: {
â”‚           "coach456": {
â”‚             canUpload: true,
â”‚             canComment: true,
â”‚             canDelete: false
â”‚           }
â”‚         }
â”‚       - videoCount: 3
â”‚       - createdAt, updatedAt

/videos/
â”‚   â”œâ”€â”€ {videoID_1}
â”‚   â”‚   - fileName: "game_Tigers_2025-11-22.mov"
â”‚   â”‚   - firebaseStorageURL: "https://...video.mov?token=abc123"
â”‚   â”‚   - thumbnailURL: "https://...thumbnail.jpg?token=xyz789"   â† NEW!
â”‚   â”‚   - uploadedBy: "coach456"
â”‚   â”‚   - uploadedByName: "Coach Smith"
â”‚   â”‚   - sharedFolderID: "folder_abc123"
â”‚   â”‚   - isHighlight: false
â”‚   â”‚   - videoType: "game"
â”‚   â”‚   - gameOpponent: "Tigers"
â”‚   â”‚   - gameDate: 2025-11-22
â”‚   â”‚   - notes: "Great hitting performance"
â”‚   â”‚   - createdAt: Date()
â”‚   â”‚   - fileSize: 150000000  (150MB)
â”‚   â”‚   - duration: 420.5      (7 minutes)
â”‚   â”‚
â”‚   â””â”€â”€ {videoID_2}
â”‚       - ...

/invitations/
    â””â”€â”€ {invitationID}
        - athleteID, coachEmail, folderID, status, ...
```

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY TOKEN VALIDATION                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VIDEO URL WITH TOKEN:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
https://firebasestorage.googleapis.com/v0/b/playerpath-app.appspot.com/
o/shared_folders%2Ffolder123%2Fvideo.mov?alt=media&token=abc123xyz789

                                                          â†‘
                                                    Security Token


WHEN ACCESSED:
â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚     or      â”‚  1. Request video with token
â”‚  AVPlayer   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
                                            â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚  Firebase Storage     â”‚
                                â”‚  Security Engine      â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                          2. Validate token & check rules
                                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                           â”‚                           â”‚
            â–¼                           â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check User   â”‚          â”‚ Check Folder â”‚           â”‚ Verify Token â”‚
    â”‚ Authenticatedâ”‚          â”‚ Permissions  â”‚           â”‚ Not Revoked  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚                          â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  All checks   â”‚
                 â”‚    pass?      â”‚
                 â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                     â”‚       â”‚
                 YES â”‚       â”‚ NO
                     â”‚       â”‚
                     â–¼       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ âœ… Serveâ”‚   â”‚ âŒ 403  â”‚
            â”‚  Video  â”‚   â”‚ Denied  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PERMISSION CHECK PSEUDOCODE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function canAccessVideo(user, videoURL) {
  // 1. Parse folder ID from URL
  folderID = extractFolderID(videoURL)
  
  // 2. Query Firestore for folder
  folder = firestore.collection('sharedFolders').doc(folderID).get()
  
  // 3. Check if user is owner
  if (user.uid == folder.ownerAthleteID) {
    return true  // âœ… Owner can always access
  }
  
  // 4. Check if user is shared coach
  if (folder.sharedWithCoachIDs.includes(user.uid)) {
    return true  // âœ… Shared coach can access
  }
  
  // 5. Otherwise deny
  return false  // âŒ Unauthorized
}


INSTANT REVOCATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When coach is removed from folder:

1. Update Firestore:
   sharedFolders/{folderID}
     sharedWithCoachIDs: remove "coach456"

2. Next time coach tries to access video:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Storage checks folder          â”‚
   â”‚ "coach456" not in shared list  â”‚
   â”‚ âŒ Access Denied - 403         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. No URL regeneration needed!
   Token still valid, but rules say NO ACCESS
```

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PROGRESS TRACKING                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UPLOAD PHASES:
â•â•â•â•â•â•â•â•â•â•â•â•â•

 0%                    20%                                             100%
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                                               â”‚
 â”‚  Thumbnail Gen      â”‚            Video Upload                      â”‚
 â”‚  & Upload           â”‚        (80% of total progress)               â”‚
 â”‚  (20% of total)     â”‚                                               â”‚
 â”‚                     â”‚                                               â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DETAILED BREAKDOWN:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 1: Thumbnail Generation (0% â†’ 10%)
â”œâ”€ Load video asset
â”œâ”€ Create image generator
â”œâ”€ Extract frame at 1 second
â”œâ”€ Resize to 160x120
â”œâ”€ Compress to JPEG
â””â”€ Save to local file

Phase 2: Thumbnail Upload (10% â†’ 20%)
â”œâ”€ Read thumbnail data
â”œâ”€ Create Storage reference
â”œâ”€ Upload to Firebase
â””â”€ Get download URL

Phase 3: Video Upload (20% â†’ 100%)
â”œâ”€ Read video data
â”œâ”€ Create Storage reference
â”œâ”€ Start upload task
â”œâ”€ Monitor progress:
â”‚  â”œâ”€ 20% = 0 bytes uploaded
â”‚  â”œâ”€ 60% = 50% of video uploaded
â”‚  â””â”€ 100% = All bytes uploaded
â””â”€ Get download URL

Phase 4: Metadata Save (100%)
â””â”€ Save to Firestore


UI DISPLAY:
â•â•â•â•â•â•â•â•â•â•

[====================                    ] 50%
â†‘                                         â†‘
0%                                       100%

Uploading: 50%

Progress calculation:
if generating_thumbnail:
    progress = 0.0 â†’ 0.1   (10%)
elif uploading_thumbnail:
    progress = 0.1 â†’ 0.2   (20%)
elif uploading_video:
    progress = 0.2 + (video_progress * 0.8)
    // Maps video's 0-100% to overall 20-100%
```

This comprehensive diagram shows the complete architecture! ğŸ¯
